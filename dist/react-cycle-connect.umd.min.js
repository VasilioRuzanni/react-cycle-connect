!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("xstream"),require("xstream/extra/sampleCombine"),require("xstream/extra/dropRepeats"),require("@cycle/isolate"),require("react")):"function"==typeof define&&define.amd?define(["exports","xstream","xstream/extra/sampleCombine","xstream/extra/dropRepeats","@cycle/isolate","react"],n):n(e.reactCycleConnect={},e.xstream,e.xstream,e.xstream,e.CycleIsolate,e.React)}(this,function(e,n,t,r,o,i){"use strict";var c="default"in n?n.default:n;t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o;var u="default"in i?i.default:i;function a(){return function(e){e.addListener({next:function(e){"function"==typeof e.fn&&e.fn.apply(null,e.args)}})}}function p(e){return function(n,t){return function(r){e._n({type:n,value:void 0!==t?t:r})}}}function s(e){return new Proxy({},{get:function(n,t){return e.call(null,t)}})}var f="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var l,d,y=(function(e,n){function t(){var e;return(e="undefined"!=typeof window?window:void 0!==f?f:this).Cyclejs=e.Cyclejs||{},(e=e.Cyclejs).adaptStream=e.adaptStream||function(e){return e},e}Object.defineProperty(n,"__esModule",{value:!0}),n.setAdapt=function(e){t().adaptStream=e},n.adapt=function(e){return t().adaptStream(e)}}(l={exports:{}},l.exports),l.exports);(d=y)&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")&&d.default;y.setAdapt;var m=y.adapt,v=function(){function e(e){this._interaction$=m(e)}return e.prototype.select=function(e){return this._interaction$.filter(function(n){return n.type===e}).map(function(e){return e.value})},e}();function h(){var e="interactions",n="fnCallEffect",r=c.create();return{interactionsWrapper:function(o){return function(i){var u=new v(r);i[e]=new Proxy(u,{get:function(e,n){return void 0===e[n]?e.select(n):e[n]}});var a=o(i),p=a[e],s=i.props;if(p&&s){var f=s.props$,l=p.compose(t(f)).map(function(e){var n=e[0],t=e[1],r=Object.keys(n).filter(function(e){return"function"==typeof t[e]}).map(function(e){return n[e].map(function(n){return{fn:t[e],args:[n]}})});return c.merge.apply(null,r)}).flatten();a[n]=a[n]?c.merge(a[n],l):l}return a}},interactFn:p(r)}}var b=function(e,n){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};var w=function(){return(w=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};var x=["willMount","didMount","willReceiveProps","willUpdate","didUpdate","willUnmount","didCatch"],_=function(){return function(e){this.lifecycleStreams=e}}();function P(){var e="lifecycle",t={};return x.forEach(function(e){t[e+"$"]=new n.Stream}),{lifecycleWrapper:function(n){return function(r){var o,i=w(w({},r),((o={})[e]=new _(t),o));return n(i)}},lifecycleStreams:t}}x.forEach(function(e){_.prototype[e]=function(){return this.lifecycleStreams[e+"$"]}});var C=function(){function e(e){this._props$=e.compose(r()).remember(),this.props$=m(this._props$)}return e.prototype.pluck=function(e){return this._props$.map(function(n){return n&&n[e]||void 0}).compose(r()).remember()},e.prototype.select=function(n){return new e(this.pluck(n))},e}();function g(e,n){var t="props",r=c.createWithMemory().endWhen(n);return{propsWrapper:function(o){return function(i){var u,a=c.create(),p=c.merge(e,a).fold(function(e,n){return w(w({},e),n)},void 0).drop(1).remember().endWhen(n),s=w(w({},i),((u={})[t]=new C(p),u)),f=o(s),l=f[t];return delete f[t],p.addListener({next:function(e){return r._n(e)}}),l&&c.fromObservable(l).endWhen(n).addListener({next:function(e){return a._n(e)},complete:function(){return a._c()},error:function(e){return a._e(e)}}),f}},props$:r}}function O(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=c.create());return n}function S(e,n){return Object.keys(n).filter(function(n){return!!e[n]}).map(function(t){return r=e[t],c.fromObservable(n[t]).subscribe({next:function(e){return r._n(e)},error:function(e){return r._e(e)},complete:function(){}});var r})}function $(e,n){return function(t){return n(e(t))}}function W(e,n,t,r,i,c){void 0===n&&(n={}),void 0===t&&(t={}),void 0===r&&(r={});var u=!!n.root,a=n.drivers,p=n.isolate,s=u&&a?O(a):{},f={},l=[],d=[],y={};var m=function(e,n,t,r){var i=r&&void 0!==r.isolate?r.isolate:void 0;if(i&&(n=i),!n)return e;var c="function"==typeof n?n(r):n;return o(e,c)}(function(e,n){return void 0===n&&(n=[]),n.length?n.reduce($,function(e){return e})(e):e}(e,function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),o=0;for(n=0;n<t;n++)for(var i=arguments[n],c=0,u=i.length;c<u;c++,o++)r[o]=i[c];return r}(n._innerWrappers||[],[function(e){return function(n){Object.assign(f,n);var t=e(n);return Object.assign(s,O(n)),Object.assign(y,t),s}}],n.wrappers||[])),p,0,i);function v(){l.forEach(function(e){return e.unsubscribe()}),d.forEach(function(e){return e.unsubscribe()}),Object.keys(s).forEach(function(e){return s[e]._c()})}function h(){Array.prototype.push.apply(l,S(s,y))}return{sinkProxies:s,childSources:f,run:function(){if(u){var e=n.runFn;if("function"!=typeof e)throw new Error("You need the 'runFn' passed as configuration\n            option of cycleConnect(...) when 'root' option is enabled.");var o=w({fnCallEffect:function(e){e.addListener({next:function(e){"function"==typeof e.fn&&e.fn.apply(null,e.args)}})}},n.drivers),i=e(m,o);return h(),function(){v(),i()}}var c=m(t);return Array.prototype.push.apply(d,S(r,c)),h(),function(){v()}}}}var j={cycleNodeLink:function(){return null}};function k(e){return{}}function N(e,n){var t;return void 0===n&&(n={}),"object"==typeof e&&(n=e,t=k),"function"==typeof e&&(t=e),function(e){var r,o=(n.render?"customRenderFn":e&&(e.displayName||e.name||"AnonymousComponent"))||"defaultRenderFn",a=n.displayName||"cycleConnect("+o+")";return(r=function(r){function o(e,o){var i=r.call(this,e,o)||this,u=o.cycleNodeLink,a=u&&u.sources||{},p=u&&u.sinkProxies||{},f=P(),l=f.lifecycleWrapper,d=f.lifecycleStreams;i.lifecycleStreams=d,i.inputProps$=c.createWithMemory().startWith(e);var y=g(i.inputProps$,i.lifecycleStreams.willUnmount$),m=y.propsWrapper,v=y.props$;i.props$=v;var b=h(),x=b.interactionsWrapper,_=b.interactFn;i.interactFn=_,i.interactionsProp=s(_);var C=w(w({},n),{_innerWrappers:[x,m,l]});return i.cycleNode=W(t,C,a,p,e),i.subscribeToPropsUpdates(),i.disposeCycleNode=i.cycleNode.run(),i}return function(e,n){function t(){this.constructor=e}b(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}(o,r),o.prototype.getChildContext=function(){var e=this.cycleNode;return e?{cycleNodeLink:{sources:e.childSources,sinkProxies:e.sinkProxies}}:{}},o.prototype.componentDidMount=function(){this.lifecycleStreams.didMount$._n(null)},o.prototype.componentDidUpdate=function(e){this.lifecycleStreams.didUpdate$._n(e)},o.prototype.componentWillUnmount=function(){this.lifecycleStreams.willUnmount$._n(null),this.disposeCycleNode&&this.disposeCycleNode()},o.prototype.componentDidCatch=function(e,n){this.lifecycleStreams.didCatch$._n({error:e,errorInfo:n})},o.prototype.subscribeToPropsUpdates=function(){var e=this;console.log("susbcribed to props updates"),this.props$.endWhen(this.lifecycleStreams.willUnmount$).addListener({next:function(n){console.log("got a new prop",n),e.propsSnapshot=n,e.forceUpdate()}})},o.prototype.render=function(){var t=w(w({},this.propsSnapshot),{interact:this.interactFn,interactions:this.interactionsProp});return"function"==typeof n.render?n.render(t):e?u.createElement(e,t):function(e){return e.children||null}(t)},o}(i.PureComponent)).contextTypes=j,r.childContextTypes=j,r.displayName=a,r}}var U=N({isolate:function(e){return e.scope||void 0},displayName:"Isolator"})();e.Isolator=U,e.cycleConnect=N,e.makeFnCallEffectDriver=a,e.makeInteractFn=p,e.makeInteractionsProp=s,e.makeInteractionsWrapper=h,e.ReactLifecycleSource=_,e.makeReactLifecycleWrapper=P,e.ReactPropsSource=C,e.makeReactPropsWrapper=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-cycle-connect.umd.min.js.map
